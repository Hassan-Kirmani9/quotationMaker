(this["webpackJsonpquotation-maker"]=this["webpackJsonpquotation-maker"]||[]).push([[13],{215:function(e,t,a){"use strict";a.r(t);var c=a(5),s=a(1),r=a(4),n=a(13),l=a(51),i=a(52),o=a(24),u=a(25),d=a(79),b=a(3);const j=e=>{let{value:t,onChange:a,options:c,placeholder:r,error:n,className:l}=e;const[i,u]=Object(s.useState)(!1),[d,j]=Object(s.useState)(""),[m,p]=Object(s.useState)(-1),x=Object(s.useRef)(null),O=Object(s.useRef)(null),h=c.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())),y=c.find(e=>e._id===t),f=y?y.name:"",g=e=>{a(e._id),j(""),u(!1),p(-1)};return Object(b.jsxs)("div",{className:"relative",ref:x,children:[Object(b.jsx)(o.Input,{ref:O,type:"text",value:i?d:f,onChange:e=>{const t=e.target.value;j(t),u(!0),p(-1),""===t&&a("")},onFocus:()=>{u(!0),j("")},onBlur:e=>{setTimeout(()=>{var t;null!==(t=x.current)&&void 0!==t&&t.contains(e.relatedTarget)||(u(!1),j(""),p(-1))},150)},onKeyDown:e=>{var t;if(i)switch(e.key){case"ArrowDown":e.preventDefault(),p(e=>e<h.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),p(e=>e>0?e-1:h.length-1);break;case"Enter":e.preventDefault(),m>=0&&h[m]&&g(h[m]);break;case"Escape":u(!1),p(-1),null===(t=O.current)||void 0===t||t.blur()}},placeholder:r,className:"w-full ".concat(n?"border-red-500":""),autoComplete:"off"}),i&&Object(b.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto",children:0===h.length?Object(b.jsx)("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"No products found"}):h.map((e,a)=>Object(b.jsx)("div",{onClick:()=>g(e),className:"px-3 py-2 cursor-pointer text-sm ".concat(a===m?"bg-blue-50 text-blue-900":"hover:bg-gray-50"," ").concat(t===e._id?"bg-blue-100 text-blue-900":""),children:e.name},e._id))})]})};t.default=function(){const e=Object(r.g)(),{currency:t,formatCurrency:a,getCurrencySymbol:m}=Object(u.b)(),[p,x]=Object(s.useState)({client:"",title:"",description:"",discountType:"percentage",discountValue:0,taxRate:0,currency:""}),[O,h]=Object(s.useState)([{product:"",description:"",quantity:1,unitPrice:0,discountValue:0,totalPrice:0}]),[y,f]=Object(s.useState)(!1),[g,v]=Object(s.useState)({}),[N,w]=Object(s.useState)(""),[P,C]=Object(s.useState)([]),[q,_]=Object(s.useState)([]),[S,k]=Object(s.useState)(!0),[E,T]=Object(s.useState)(0),[A,F]=Object(s.useState)(0),[D,I]=Object(s.useState)(0),[L,V]=Object(s.useState)(0),[R,z]=Object(s.useState)(0),[H,B]=Object(s.useState)(0);Object(s.useEffect)(()=>{(async()=>{try{k(!0);const[e,t,a]=await Promise.all([Object(n.b)("/clients"),Object(n.b)("/products")]);e.success&&C(e.data.clients||[]),t.success&&_(t.data.products||[])}catch(e){console.error("Error fetching dropdown data:",e)}finally{k(!1)}})()},[]),Object(s.useEffect)(()=>{const e=O.reduce((e,t)=>e+(parseFloat(t.totalPrice)||0),0);T(e);const t=e*p.discountValue/100;F(t);const a=e-t,c=a*p.taxRate/100;I(c);V(a+c)},[O,p.discountType,p.discountValue,p.taxRate]),Object(s.useEffect)(()=>{const e=O.reduce((e,t)=>e+(parseFloat(t.quantity)||0)*(parseFloat(t.unitPrice)||0),0);z(e);B(e-E)},[O,E]);const Q=e=>{const{name:t,value:a}=e.target;x(e=>Object(c.a)(Object(c.a)({},e),{},{[t]:"discountValue"===t||"taxRate"===t?parseFloat(a)||0:a})),g[t]&&v(e=>Object(c.a)(Object(c.a)({},e),{},{[t]:""})),N&&w("")},W=(e,t,a)=>{const c=[...O];if(c[e][t]=a,"product"===t&&a){const t=q.find(e=>e._id===a);t&&(c[e].unitPrice=t.sellingPrice,c[e].description=t.description)}if("quantity"===t||"unitPrice"===t||"product"===t||"discountValue"===t){const t=(parseFloat(c[e].quantity)||0)*(parseFloat(c[e].unitPrice)||0),a=t*(parseFloat(c[e].discountValue)||0)/100;c[e].totalPrice=t-a}h(c)};return S?Object(b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:Object(b.jsxs)("div",{className:"text-center",children:[Object(b.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600"}),Object(b.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading form data..."})]})}):Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("div",{className:"flex justify-between items-center mb-6",children:Object(b.jsx)(l.a,{children:"Create New Quotation"})}),Object(b.jsx)("div",{className:"px-4 py-3 mb-8 bg-white rounded-lg shadow-md dark:bg-gray-800",children:Object(b.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const e={};return p.client.trim()||(e.client="Client is required"),p.title.trim()||(e.title="Title is required"),O.forEach((t,a)=>{t.product||(e["item_".concat(a,"_product")]="Product is required"),(!t.quantity||parseFloat(t.quantity)<=0)&&(e["item_".concat(a,"_quantity")]="Quantity must be greater than 0"),(!t.unitPrice||parseFloat(t.unitPrice)<0)&&(e["item_".concat(a,"_unitPrice")]="Unit price cannot be negative")}),v(e),0===Object.keys(e).length})()){f(!0),w("");try{const t=Object(c.a)(Object(c.a)({},p),{},{items:O.map(e=>({product:e.product,description:e.description,quantity:parseFloat(e.quantity),unitPrice:parseFloat(e.unitPrice),discountValue:parseFloat(e.discountValue)||0}))}),a=await Object(n.c)("/quotations",t);a.success?(alert("Quotation created successfully!"),e.push("/app/quotations")):w(a.message||"Failed to create quotation. Please try again.")}catch(r){var a,s;console.error("Error creating quotation:",r),null!==(a=r.response)&&void 0!==a&&null!==(s=a.data)&&void 0!==s&&s.message?w(r.response.data.message):r.message?w(r.message):w("Failed to create quotation. Please check your connection and try again.")}finally{f(!1)}}},children:[N&&Object(b.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:N}),Object(b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{children:"Client *"}),Object(b.jsxs)(o.Select,{className:"mt-1",name:"client",value:p.client,onChange:Q,required:!0,valid:!g.client,children:[Object(b.jsx)("option",{value:"",children:"Select Client"}),P.map(e=>Object(b.jsxs)("option",{value:e._id,children:[e.name," - ",e.businessName]},e._id))]}),g.client&&Object(b.jsx)(o.HelperText,{valid:!1,children:g.client})]}),Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{children:"Currency"}),Object(b.jsx)(o.Input,{className:"mt-1",value:"".concat(t," - Will use default currency from configuration"),readOnly:!0,disabled:!0}),Object(b.jsx)(o.HelperText,{children:"Currency is set in Configuration settings"})]}),Object(b.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(b.jsx)("span",{children:"Title *"}),Object(b.jsx)(o.Input,{className:"mt-1",name:"title",value:p.title,onChange:Q,placeholder:"Enter quotation title",required:!0,valid:!g.title}),g.title&&Object(b.jsx)(o.HelperText,{valid:!1,children:g.title})]}),Object(b.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(b.jsx)("span",{children:"Description"}),Object(b.jsx)(o.Textarea,{className:"mt-1",name:"description",value:p.description,onChange:Q,rows:"3",placeholder:"Enter quotation description"})]})]}),Object(b.jsxs)("div",{className:"mb-6",children:[Object(b.jsxs)("div",{className:"overflow-x-auto",style:{overflow:"visible"},children:["              ",Object(b.jsxs)("table",{className:"min-w-full border border-gray-200 rounded-lg",children:[Object(b.jsx)("thead",{className:"bg-gray-50",children:Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 border-b w-2/5",children:"Product"}),Object(b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 border-b w-1/12",children:"Quantity"}),Object(b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 border-b w-1/6",children:"Unit Price"}),Object(b.jsx)("th",{className:"px-0 py-3 text-left text-xs font-medium text-gray-700 border-b w-1/12",children:"Discount %"}),Object(b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 border-b w-1/4",children:"Total Price"}),Object(b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 border-b w-1/12",children:"Action"})]})}),Object(b.jsx)("tbody",{className:"bg-white",children:O.map((e,t)=>Object(b.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[Object(b.jsxs)("td",{className:"px-2 py-3",children:[Object(b.jsx)(j,{value:e.product,onChange:e=>W(t,"product",e),options:q,placeholder:"Search and select product...",error:g["item_".concat(t,"_product")],className:"w-full"}),g["item_".concat(t,"_product")]&&Object(b.jsx)(o.HelperText,{valid:!1,className:"mt-1 text-xs",children:g["item_".concat(t,"_product")]})]}),Object(b.jsxs)("td",{className:"px-2 py-3",children:[Object(b.jsx)(o.Input,{type:"number",step:"1",min:"0",value:e.quantity,onChange:e=>W(t,"quantity",e.target.value),placeholder:"1",required:!0,valid:!g["item_".concat(t,"_quantity")],className:"w-full"}),g["item_".concat(t,"_quantity")]&&Object(b.jsx)(o.HelperText,{valid:!1,className:"mt-1 text-xs",children:g["item_".concat(t,"_quantity")]})]}),Object(b.jsxs)("td",{className:"px-2 py-3",children:[Object(b.jsx)(o.Input,{type:"number",step:"0.01",min:"0",value:e.unitPrice,onChange:e=>W(t,"unitPrice",e.target.value),placeholder:"0.00",required:!0,valid:!g["item_".concat(t,"_unitPrice")],className:"w-full"}),g["item_".concat(t,"_unitPrice")]&&Object(b.jsx)(o.HelperText,{valid:!1,className:"mt-1 text-xs",children:g["item_".concat(t,"_unitPrice")]})]}),Object(b.jsx)("td",{className:"px-2 py-3",children:Object(b.jsx)(o.Input,{type:"number",step:"0.01",min:"0",max:"100",value:e.discountValue,onChange:e=>W(t,"discountValue",e.target.value),placeholder:"0",className:"w-full"})}),Object(b.jsx)("td",{className:"px-2 py-3",children:Object(b.jsx)(o.Input,{value:e.totalPrice,readOnly:!0,className:"w-full bg-gray-50"})}),Object(b.jsx)("td",{className:"px-2 py-3 text-center",children:O.length>1&&Object(b.jsxs)(o.Button,{type:"button",layout:"outline",onClick:()=>(e=>{if(O.length>1){const t=O.filter((t,a)=>a!==e);h(t)}})(t),className:"px-2 py-1 text-xs",style:{backgroundColor:"#ffffff"},children:[Object(b.jsx)(d.b,{className:"text-red-700"}),"                "]})})]},t))})]})]}),Object(b.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>{h([...O,{product:"",description:"",quantity:1,unitPrice:0,discountValue:0,totalPrice:0}])},className:"mt-4",children:"Add Item"})]}),Object(b.jsx)(i.a,{children:"Pricing Details"}),Object(b.jsx)("div",{className:"mb-6",children:Object(b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-end",children:[Object(b.jsx)("div",{className:"col-span-3",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm",children:"Gross Amount"}),Object(b.jsx)(o.Input,{value:a(E),className:"mt-1",readOnly:!0})]})}),Object(b.jsx)("div",{className:"col-span-1",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-xs",children:"Discount %"}),Object(b.jsxs)("div",{className:"relative mt-1",children:[Object(b.jsx)(o.Input,{name:"discountValue",value:p.discountValue,onChange:Q,type:"number",step:"0.01",min:"0",max:"99",placeholder:"0",maxLength:"2",style:{WebkitAppearance:"none",MozAppearance:"textfield"},className:"pl-3 pr-6 text-left text-sm w-20"}),Object(b.jsx)("div",{className:"absolute inset-y-0 right-0 pr-2 flex items-center pointer-events-none",children:Object(b.jsx)("span",{className:"text-gray-500 text-sm",children:"%"})})]})]})}),Object(b.jsx)("div",{className:"col-span-2",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm",children:"Discount Amount"}),Object(b.jsx)(o.Input,{value:a(A),className:"mt-1",readOnly:!0})]})}),Object(b.jsx)("div",{className:"col-span-1",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm",children:"Tax %"}),Object(b.jsxs)("div",{className:"relative mt-1",children:[Object(b.jsx)(o.Input,{name:"taxRate",value:p.taxRate,onChange:Q,className:"pl-3 pr-6 text-left text-sm w-20",type:"number",step:"0.01",min:"0",max:"99",maxLength:"2",style:{WebkitAppearance:"none",MozAppearance:"textfield"}}),Object(b.jsx)("div",{className:"absolute inset-y-0 right-0 pr-2 flex items-center pointer-events-none",children:Object(b.jsx)("span",{className:"text-gray-500 text-sm",children:"%"})})]})]})}),Object(b.jsx)("div",{className:"col-span-2",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm",children:"Tax Amount"}),Object(b.jsx)(o.Input,{value:a(D),className:"mt-1",readOnly:!0})]})}),Object(b.jsx)("div",{className:"col-span-3",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm font-semibold",children:"Total Amount"}),Object(b.jsx)(o.Input,{value:"".concat(t," ").concat(L.toFixed(2)),className:"mt-1 font-semibold",readOnly:!0})]})})]})}),Object(b.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[Object(b.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>{window.confirm("Are you sure you want to cancel? All entered data will be lost.")&&e.push("/app/quotations")},disabled:y,children:"Cancel"}),Object(b.jsx)(o.Button,{type:"submit",style:{backgroundColor:"#AA1A21"},className:"text-white",disabled:y||0===P.length||0===q.length,children:y?"Creating...":"Create Quotation"})]})]})})]})}},51:function(e,t,a){"use strict";a(1);var c=a(3);t.a=function(e){let{children:t}=e;return Object(c.jsx)("h1",{className:"my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200",children:t})}},52:function(e,t,a){"use strict";a(1);var c=a(3);t.a=function(e){let{children:t}=e;return Object(c.jsx)("h2",{className:"mb-4 text-lg font-semibold text-gray-600 dark:text-gray-300",children:t})}},68:function(e,t,a){"use strict";a.d(t,"a",function(){return j});var c=a(1),s={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},r=c.createContext&&c.createContext(s),n=["attr","size","title"];function l(e,t){if(null==e)return{};var a,c,s=function(e,t){if(null==e)return{};var a={};for(var c in e)if(Object.prototype.hasOwnProperty.call(e,c)){if(t.indexOf(c)>=0)continue;a[c]=e[c]}return a}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(c=0;c<r.length;c++)a=r[c],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(s[a]=e[a])}return s}function i(){return i=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var c in a)Object.prototype.hasOwnProperty.call(a,c)&&(e[c]=a[c])}return e},i.apply(this,arguments)}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var c=Object.getOwnPropertySymbols(e);t&&(c=c.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),a.push.apply(a,c)}return a}function u(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach(function(t){d(e,t,a[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))})}return e}function d(e,t,a){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var a=e[Symbol.toPrimitive];if(void 0!==a){var c=a.call(e,t||"default");if("object"!=typeof c)return c;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function b(e){return e&&e.map((e,t)=>c.createElement(e.tag,u({key:t},e.attr),b(e.child)))}function j(e){return t=>c.createElement(m,i({attr:u({},e.attr)},t),b(e.child))}function m(e){var t=t=>{var a,{attr:s,size:r,title:o}=e,d=l(e,n),b=r||t.size||"1em";return t.className&&(a=t.className),e.className&&(a=(a?a+" ":"")+e.className),c.createElement("svg",i({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,d,{className:a,style:u(u({color:e.color||t.color},t.style),e.style),height:b,width:b,xmlns:"http://www.w3.org/2000/svg"}),o&&c.createElement("title",null,o),e.children)};return void 0!==r?c.createElement(r.Consumer,null,e=>t(e)):t(s)}}}]);
//# sourceMappingURL=13.fb250240.chunk.js.map