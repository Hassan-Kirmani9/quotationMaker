(this["webpackJsonpquotation-maker"]=this["webpackJsonpquotation-maker"]||[]).push([[15],{214:function(e,t,c){"use strict";c.r(t);var a=c(5),n=c(1),s=c(4),i=c(13),l=c(51),r=c(52),o=c(24),d=c(25),u=c(3);t.default=function(){const e=Object(s.g)(),{currency:t,formatCurrency:c,getCurrencySymbol:j}=Object(d.b)(),[b,m]=Object(n.useState)({client:"",title:"",description:"",discountType:"percentage",discountValue:0,taxRate:0,currency:"",notes:"",terms:""}),[p,x]=Object(n.useState)([{product:"",description:"",quantity:1,unitPrice:0,totalPrice:0}]),[O,h]=Object(n.useState)(!1),[g,y]=Object(n.useState)({}),[v,f]=Object(n.useState)(""),[N,q]=Object(n.useState)([]),[P,_]=Object(n.useState)([]),[C,T]=Object(n.useState)(!0),[S,w]=Object(n.useState)(0),[L,k]=Object(n.useState)(0),[F,I]=Object(n.useState)(0),[A,E]=Object(n.useState)(0);Object(n.useEffect)(()=>{(async()=>{try{T(!0);const[e,t,c]=await Promise.all([Object(i.b)("/clients"),Object(i.b)("/products")]);e.success&&q(e.data.clients||[]),t.success&&_(t.data.products||[])}catch(e){console.error("Error fetching dropdown data:",e)}finally{T(!1)}})()},[]),Object(n.useEffect)(()=>{const e=p.reduce((e,t)=>e+(parseFloat(t.totalPrice)||0),0);w(e);const t="percentage"===b.discountType?e*b.discountValue/100:b.discountValue;k(t);const c=e-t,a=c*b.taxRate/100;I(a);E(c+a)},[p,b.discountType,b.discountValue,b.taxRate]);const R=e=>{const{name:t,value:c}=e.target;m(e=>Object(a.a)(Object(a.a)({},e),{},{[t]:"discountValue"===t||"taxRate"===t?parseFloat(c)||0:c})),g[t]&&y(e=>Object(a.a)(Object(a.a)({},e),{},{[t]:""})),v&&f("")},V=(e,t,c)=>{const a=[...p];if(a[e][t]=c,"product"===t&&c){const t=P.find(e=>e._id===c);t&&(a[e].unitPrice=t.sellingPrice,a[e].description=t.description)}if("quantity"===t||"unitPrice"===t||"product"===t){const t=parseFloat(a[e].quantity)||0,c=parseFloat(a[e].unitPrice)||0;a[e].totalPrice=t*c}x(a)};return C?Object(u.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:Object(u.jsxs)("div",{className:"text-center",children:[Object(u.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600"}),Object(u.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading form data..."})]})}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("div",{className:"flex justify-between items-center mb-6",children:Object(u.jsx)(l.a,{children:"Create New Quotation"})}),Object(u.jsx)("div",{className:"px-4 py-3 mb-8 bg-white rounded-lg shadow-md dark:bg-gray-800",children:Object(u.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const e={};return b.client.trim()||(e.client="Client is required"),b.title.trim()||(e.title="Title is required"),p.forEach((t,c)=>{t.product||(e["item_".concat(c,"_product")]="Product is required"),(!t.quantity||parseFloat(t.quantity)<=0)&&(e["item_".concat(c,"_quantity")]="Quantity must be greater than 0"),(!t.unitPrice||parseFloat(t.unitPrice)<0)&&(e["item_".concat(c,"_unitPrice")]="Unit price cannot be negative")}),y(e),0===Object.keys(e).length})()){h(!0),f("");try{const t=Object(a.a)(Object(a.a)({},b),{},{items:p.map(e=>({product:e.product,description:e.description,quantity:parseFloat(e.quantity),unitPrice:parseFloat(e.unitPrice)}))}),c=await Object(i.c)("/quotations",t);c.success?(alert("Quotation created successfully!"),e.push("/app/quotations")):f(c.message||"Failed to create quotation. Please try again.")}catch(s){var c,n;console.error("Error creating quotation:",s),null!==(c=s.response)&&void 0!==c&&null!==(n=c.data)&&void 0!==n&&n.message?f(s.response.data.message):s.message?f(s.message):f("Failed to create quotation. Please check your connection and try again.")}finally{h(!1)}}},children:[v&&Object(u.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:v}),Object(u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Client *"}),Object(u.jsxs)(o.Select,{className:"mt-1",name:"client",value:b.client,onChange:R,required:!0,valid:!g.client,children:[Object(u.jsx)("option",{value:"",children:"Select Client"}),N.map(e=>Object(u.jsxs)("option",{value:e._id,children:[e.name," - ",e.businessName]},e._id))]}),g.client&&Object(u.jsx)(o.HelperText,{valid:!1,children:g.client})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Currency"}),Object(u.jsx)(o.Input,{className:"mt-1",value:"".concat(t," - Will use default currency from configuration"),readOnly:!0,disabled:!0}),Object(u.jsx)(o.HelperText,{children:"Currency is set in Configuration settings"})]}),Object(u.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(u.jsx)("span",{children:"Title *"}),Object(u.jsx)(o.Input,{className:"mt-1",name:"title",value:b.title,onChange:R,placeholder:"Enter quotation title",required:!0,valid:!g.title}),g.title&&Object(u.jsx)(o.HelperText,{valid:!1,children:g.title})]}),Object(u.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(u.jsx)("span",{children:"Description"}),Object(u.jsx)(o.Textarea,{className:"mt-1",name:"description",value:b.description,onChange:R,rows:"3",placeholder:"Enter quotation description"})]})]}),Object(u.jsx)(r.a,{children:"Quotation Items"}),Object(u.jsxs)("div",{className:"mb-6",children:[p.map((e,t)=>Object(u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 mb-4 p-4 border rounded-lg",children:[Object(u.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(u.jsx)("span",{children:"Product *"}),Object(u.jsxs)(o.Select,{className:"mt-1",value:e.product,onChange:e=>V(t,"product",e.target.value),required:!0,valid:!g["item_".concat(t,"_product")],children:[Object(u.jsx)("option",{value:"",children:"Select Product"}),P.map(e=>Object(u.jsx)("option",{value:e._id,children:e.name},e._id))]}),g["item_".concat(t,"_product")]&&Object(u.jsx)(o.HelperText,{valid:!1,children:g["item_".concat(t,"_product")]})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Quantity *"}),Object(u.jsx)(o.Input,{className:"mt-1",type:"number",step:"0.01",min:"0",value:e.quantity,onChange:e=>V(t,"quantity",e.target.value),placeholder:"1",required:!0,valid:!g["item_".concat(t,"_quantity")]}),g["item_".concat(t,"_quantity")]&&Object(u.jsx)(o.HelperText,{valid:!1,children:g["item_".concat(t,"_quantity")]})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Unit Price *"}),Object(u.jsx)(o.Input,{className:"mt-1",type:"number",step:"0.01",min:"0",value:e.unitPrice,onChange:e=>V(t,"unitPrice",e.target.value),placeholder:"0.00",required:!0,valid:!g["item_".concat(t,"_unitPrice")]}),g["item_".concat(t,"_unitPrice")]&&Object(u.jsx)(o.HelperText,{valid:!1,children:g["item_".concat(t,"_unitPrice")]})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Total Price"}),Object(u.jsx)(o.Input,{value:c(e.totalPrice),readOnly:!0})]}),Object(u.jsx)("div",{className:"flex items-end",children:Object(u.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>(e=>{if(p.length>1){const t=p.filter((t,c)=>c!==e);x(t)}})(t),disabled:1===p.length,className:"w-full",children:"Remove"})})]},t)),Object(u.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>{x([...p,{product:"",description:"",quantity:1,unitPrice:0,totalPrice:0}])},className:"mt-2",children:"Add Item"})]}),Object(u.jsx)(r.a,{children:"Pricing Details"}),Object(u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Subtotal"}),Object(u.jsx)(o.Input,{value:c(S),className:"mt-1",readOnly:!0})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Discount Type"}),Object(u.jsxs)(o.Select,{name:"discountType",value:b.discountType,onChange:R,className:"mt-1",children:[Object(u.jsx)("option",{value:"percentage",children:"Percentage"}),Object(u.jsx)("option",{value:"fixed",children:"Fixed Amount"})]})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Discount Value"}),Object(u.jsx)(o.Input,{name:"discountValue",value:b.discountValue,onChange:R,className:"mt-1",type:"number",step:"0.01",min:"0",placeholder:"percentage"===b.discountType?"0%":"0.00"})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Discount Amount"}),Object(u.jsx)(o.Input,{value:c(L),className:"mt-1",readOnly:!0})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Tax Rate (%)"}),Object(u.jsx)(o.Input,{name:"taxRate",value:b.taxRate,onChange:R,className:"mt-1",type:"number",step:"0.01",min:"0",max:"100"})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Tax Amount"}),Object(u.jsx)(o.Input,{value:c(F),className:"mt-1",readOnly:!0})]}),Object(u.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(u.jsx)("span",{className:"text-lg font-semibold",children:"Total Amount"}),Object(u.jsx)(o.Input,{value:A.toFixed(2),className:"mt-1 text-lg font-semibold",type:"number",readOnly:!0})]})]}),Object(u.jsxs)("div",{className:"grid grid-cols-1 gap-4 mb-6",children:[Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Terms & Conditions"}),Object(u.jsx)(o.Textarea,{className:"mt-1",name:"terms",value:b.terms,onChange:R,rows:"3",placeholder:"Enter terms and conditions"})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Notes"}),Object(u.jsx)(o.Textarea,{className:"mt-1",name:"notes",value:b.notes,onChange:R,rows:"2",placeholder:"Enter any additional notes"})]})]}),Object(u.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[Object(u.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>{window.confirm("Are you sure you want to cancel? All entered data will be lost.")&&e.push("/app/quotations")},disabled:O,children:"Cancel"}),Object(u.jsx)(o.Button,{type:"submit",style:{backgroundColor:"#AA1A21"},className:"text-white",disabled:O||0===N.length||0===P.length,children:O?"Creating...":"Create Quotation"})]})]})})]})}},51:function(e,t,c){"use strict";c(1);var a=c(3);t.a=function(e){let{children:t}=e;return Object(a.jsx)("h1",{className:"my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200",children:t})}},52:function(e,t,c){"use strict";c(1);var a=c(3);t.a=function(e){let{children:t}=e;return Object(a.jsx)("h2",{className:"mb-4 text-lg font-semibold text-gray-600 dark:text-gray-300",children:t})}}}]);
//# sourceMappingURL=15.556f98ad.chunk.js.map