(this["webpackJsonpquotation-maker"]=this["webpackJsonpquotation-maker"]||[]).push([[14],{217:function(e,t,c){"use strict";c.r(t);var a=c(5),s=c(1),n=c(4),r=c(13),i=c(51),l=c(52),o=c(24),u=c(25),d=c(79),b=c(3);const j=e=>{let{value:t,onChange:c,options:a,placeholder:n,error:r,className:i}=e;const[l,u]=Object(s.useState)(!1),[d,j]=Object(s.useState)(""),[m,p]=Object(s.useState)(-1),x=Object(s.useRef)(null),O=Object(s.useRef)(null),h=a.filter(e=>e.name.toLowerCase().includes(d.toLowerCase())),y=a.find(e=>e._id===t),f=y?y.name:"",g=e=>{c(e._id),j(""),u(!1),p(-1)};return Object(b.jsxs)("div",{className:"relative",ref:x,children:[Object(b.jsx)(o.Input,{ref:O,type:"text",value:l?d:f,onChange:e=>{const t=e.target.value;j(t),u(!0),p(-1),""===t&&c("")},onFocus:()=>{u(!0),j("")},onBlur:e=>{setTimeout(()=>{var t;null!==(t=x.current)&&void 0!==t&&t.contains(e.relatedTarget)||(u(!1),j(""),p(-1))},150)},onKeyDown:e=>{var t;if(l)switch(e.key){case"ArrowDown":e.preventDefault(),p(e=>e<h.length-1?e+1:0);break;case"ArrowUp":e.preventDefault(),p(e=>e>0?e-1:h.length-1);break;case"Enter":e.preventDefault(),m>=0&&h[m]&&g(h[m]);break;case"Escape":u(!1),p(-1),null===(t=O.current)||void 0===t||t.blur()}},placeholder:n,className:"w-full ".concat(r?"border-red-500":""),autoComplete:"off"}),l&&Object(b.jsx)("div",{className:"absolute z-50 w-full mt-1 bg-white border border-gray-300 rounded-md shadow-lg max-h-48 overflow-y-auto",children:0===h.length?Object(b.jsx)("div",{className:"px-3 py-2 text-gray-500 text-sm",children:"No products found"}):h.map((e,c)=>Object(b.jsx)("div",{onClick:()=>g(e),className:"px-3 py-2 cursor-pointer text-sm ".concat(c===m?"bg-blue-50 text-blue-900":"hover:bg-gray-50"," ").concat(t===e._id?"bg-blue-100 text-blue-900":""),children:e.name},e._id))})]})};t.default=function(){const e=Object(n.g)(),{currency:t,formatCurrency:c,getCurrencySymbol:m}=Object(u.b)(),{id:p}=Object(n.i)(),[x,O]=Object(s.useState)({client:"",title:"",description:"",discountType:"percentage",discountValue:0,taxRate:0,currency:""}),[h,y]=Object(s.useState)([{product:"",description:"",quantity:1,unitPrice:0,discountValue:0,totalPrice:0}]),[f,g]=Object(s.useState)(!1),[v,N]=Object(s.useState)(!0),[w,P]=Object(s.useState)({}),[q,C]=Object(s.useState)(""),[_,S]=Object(s.useState)([]),[k,E]=Object(s.useState)([]),[T,F]=Object(s.useState)(0),[V,A]=Object(s.useState)(0),[D,I]=Object(s.useState)(0),[L,R]=Object(s.useState)(0),[z,H]=Object(s.useState)(0),[Q,B]=Object(s.useState)(0);Object(s.useEffect)(()=>{p&&(async()=>{try{var e;N(!0),C("");const[t,c,a]=await Promise.all([Object(r.b)("/quotations/".concat(p)),Object(r.b)("/clients"),Object(r.b)("/products")]);if(!t.success)throw new Error("Quotation not found");const s=t.data.quotation;O({client:(null===(e=s.client)||void 0===e?void 0:e._id)||"",title:s.title||"",description:s.description||"",discountType:s.discountType||"percentage",discountValue:s.discountValue||0,taxRate:s.taxRate||0,currency:s.currency||""}),s.items&&s.items.length>0&&y(s.items.map(e=>{var t;return{product:(null===(t=e.product)||void 0===t?void 0:t._id)||e.product||"",description:e.description||"",quantity:e.quantity||1,unitPrice:e.unitPrice||0,discountValue:e.discountValue||0,totalPrice:e.totalPrice||0}})),c.success&&S(c.data.clients||[]),a.success&&E(a.data.products||[])}catch(t){console.error("Error loading quotation:",t),C(t.message||"Failed to load quotation")}finally{N(!1)}})()},[p]),Object(s.useEffect)(()=>{const e=h.reduce((e,t)=>e+(parseFloat(t.totalPrice)||0),0);F(e);const t=e*x.discountValue/100;A(t);const c=e-t,a=c*x.taxRate/100;I(a);R(c+a)},[h,x.discountType,x.discountValue,x.taxRate]),Object(s.useEffect)(()=>{const e=h.reduce((e,t)=>e+(parseFloat(t.quantity)||0)*(parseFloat(t.unitPrice)||0),0);H(e);B(e-T)},[h,T]);const U=e=>{const{name:t,value:c}=e.target;O(e=>Object(a.a)(Object(a.a)({},e),{},{[t]:"discountValue"===t||"taxRate"===t?parseFloat(c)||0:c})),w[t]&&P(e=>Object(a.a)(Object(a.a)({},e),{},{[t]:""})),q&&C("")},W=(e,t,c)=>{const a=[...h];if(a[e][t]=c,"product"===t&&c){const t=k.find(e=>e._id===c);t&&(a[e].unitPrice=t.sellingPrice,a[e].description=t.description)}if("quantity"===t||"unitPrice"===t||"product"===t||"discountValue"===t){const t=(parseFloat(a[e].quantity)||0)*(parseFloat(a[e].unitPrice)||0),c=t*(parseFloat(a[e].discountValue)||0)/100;a[e].totalPrice=t-c}y(a)};return v?Object(b.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:Object(b.jsxs)("div",{className:"text-center",children:[Object(b.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600"}),Object(b.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading quotation..."})]})}):Object(b.jsxs)(b.Fragment,{children:[Object(b.jsx)("div",{className:"flex justify-between items-center mb-6",children:Object(b.jsx)(i.a,{children:"Edit Quotation"})}),Object(b.jsx)("div",{className:"px-4 py-3 mb-8 bg-white rounded-lg shadow-md dark:bg-gray-800",children:Object(b.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const e={};return x.client.trim()||(e.client="Client is required"),x.title.trim()||(e.title="Title is required"),h.forEach((t,c)=>{t.product||(e["item_".concat(c,"_product")]="Product is required"),(!t.quantity||parseFloat(t.quantity)<=0)&&(e["item_".concat(c,"_quantity")]="Quantity must be greater than 0"),(!t.unitPrice||parseFloat(t.unitPrice)<0)&&(e["item_".concat(c,"_unitPrice")]="Unit price cannot be negative")}),P(e),0===Object.keys(e).length})()){g(!0),C("");try{const t=Object(a.a)(Object(a.a)({},x),{},{items:h.map(e=>({product:e.product,description:e.description,quantity:parseFloat(e.quantity),unitPrice:parseFloat(e.unitPrice),discountValue:parseFloat(e.discountValue)||0}))}),c=await Object(r.d)("/quotations/".concat(p),t);c.success?(alert("Quotation updated successfully!"),e.push("/app/quotations")):C(c.message||"Failed to update quotation. Please try again.")}catch(n){var c,s;console.error("Error updating quotation:",n),null!==(c=n.response)&&void 0!==c&&null!==(s=c.data)&&void 0!==s&&s.message?C(n.response.data.message):n.message?C(n.message):C("Failed to update quotation. Please check your connection and try again.")}finally{g(!1)}}},children:[q&&Object(b.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:q}),Object(b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{children:"Client *"}),Object(b.jsxs)(o.Select,{className:"mt-1",name:"client",value:x.client,onChange:U,required:!0,valid:!w.client,children:[Object(b.jsx)("option",{value:"",children:"Select Client"}),_.map(e=>Object(b.jsxs)("option",{value:e._id,children:[e.name," - ",e.businessName]},e._id))]}),w.client&&Object(b.jsx)(o.HelperText,{valid:!1,children:w.client})]}),Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{children:"Currency"}),Object(b.jsx)(o.Input,{className:"mt-1",value:"".concat(t," - Will use default currency from configuration"),readOnly:!0,disabled:!0}),Object(b.jsx)(o.HelperText,{children:"Currency is set in Configuration settings"})]}),Object(b.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(b.jsx)("span",{children:"Title *"}),Object(b.jsx)(o.Input,{className:"mt-1",name:"title",value:x.title,onChange:U,placeholder:"Enter quotation title",required:!0,valid:!w.title}),w.title&&Object(b.jsx)(o.HelperText,{valid:!1,children:w.title})]}),Object(b.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(b.jsx)("span",{children:"Description"}),Object(b.jsx)(o.Textarea,{className:"mt-1",name:"description",value:x.description,onChange:U,rows:"3",placeholder:"Enter quotation description"})]})]}),Object(b.jsxs)("div",{className:"mb-6",children:[Object(b.jsx)("div",{className:"overflow-x-auto",style:{overflow:"visible"},children:Object(b.jsxs)("table",{className:"min-w-full border border-gray-200 rounded-lg",children:[Object(b.jsx)("thead",{className:"bg-gray-50",children:Object(b.jsxs)("tr",{children:[Object(b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 border-b w-2/5",children:"Product"}),Object(b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 border-b w-1/12",children:"Quantity"}),Object(b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 border-b w-1/6",children:"Unit Price"}),Object(b.jsx)("th",{className:"px-0 py-3 text-left text-xs font-medium text-gray-700 border-b w-1/12",children:"Discount %"}),Object(b.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-700 border-b w-1/4",children:"Total Price"}),Object(b.jsx)("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-700 border-b w-1/12",children:"Action"})]})}),Object(b.jsx)("tbody",{className:"bg-white",children:h.map((e,t)=>Object(b.jsxs)("tr",{className:"border-b hover:bg-gray-50",children:[Object(b.jsxs)("td",{className:"px-2 py-3",children:[Object(b.jsx)(j,{value:e.product,onChange:e=>W(t,"product",e),options:k,placeholder:"Search and select product...",error:w["item_".concat(t,"_product")],className:"w-full"}),w["item_".concat(t,"_product")]&&Object(b.jsx)(o.HelperText,{valid:!1,className:"mt-1 text-xs",children:w["item_".concat(t,"_product")]})]}),Object(b.jsxs)("td",{className:"px-2 py-3",children:[Object(b.jsx)(o.Input,{type:"number",step:"1",min:"0",value:e.quantity,onChange:e=>W(t,"quantity",e.target.value),placeholder:"1",required:!0,valid:!w["item_".concat(t,"_quantity")],className:"w-full"}),w["item_".concat(t,"_quantity")]&&Object(b.jsx)(o.HelperText,{valid:!1,className:"mt-1 text-xs",children:w["item_".concat(t,"_quantity")]})]}),Object(b.jsxs)("td",{className:"px-2 py-3",children:[Object(b.jsx)(o.Input,{type:"number",step:"0.01",min:"0",value:e.unitPrice,onChange:e=>W(t,"unitPrice",e.target.value),placeholder:"0.00",required:!0,valid:!w["item_".concat(t,"_unitPrice")],className:"w-full"}),w["item_".concat(t,"_unitPrice")]&&Object(b.jsx)(o.HelperText,{valid:!1,className:"mt-1 text-xs",children:w["item_".concat(t,"_unitPrice")]})]}),Object(b.jsx)("td",{className:"px-2 py-3",children:Object(b.jsx)(o.Input,{type:"number",step:"0.01",min:"0",max:"100",value:e.discountValue,onChange:e=>W(t,"discountValue",e.target.value),placeholder:"0",className:"w-full"})}),Object(b.jsx)("td",{className:"px-2 py-3",children:Object(b.jsx)(o.Input,{value:e.totalPrice,readOnly:!0,className:"w-full bg-gray-50"})}),Object(b.jsx)("td",{className:"px-2 py-3 text-center",children:h.length>1&&Object(b.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>(e=>{if(h.length>1){const t=h.filter((t,c)=>c!==e);y(t)}})(t),className:"px-2 py-1 text-xs",style:{backgroundColor:"#ffffff"},children:Object(b.jsx)(d.b,{className:"text-red-700"})})})]},t))})]})}),Object(b.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>{y([...h,{product:"",description:"",quantity:1,unitPrice:0,discountValue:0,totalPrice:0}])},className:"mt-4",children:"Add Item"})]}),Object(b.jsx)(l.a,{children:"Pricing Details"}),Object(b.jsx)("div",{className:"mb-6",children:Object(b.jsxs)("div",{className:"grid grid-cols-12 gap-2 items-end",children:[Object(b.jsx)("div",{className:"col-span-3",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm",children:"Gross Amount"}),Object(b.jsx)(o.Input,{value:c(T),className:"mt-1",readOnly:!0})]})}),Object(b.jsx)("div",{className:"col-span-1",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-xs",children:"Discount %"}),Object(b.jsxs)("div",{className:"relative mt-1",children:[Object(b.jsx)(o.Input,{name:"discountValue",value:x.discountValue,onChange:U,type:"number",step:"0.01",min:"0",max:"99",placeholder:"0",maxLength:"2",style:{WebkitAppearance:"none",MozAppearance:"textfield"},className:"pl-3 pr-6 text-left text-sm w-20"}),Object(b.jsx)("div",{className:"absolute inset-y-0 right-0 pr-2 flex items-center pointer-events-none",children:Object(b.jsx)("span",{className:"text-gray-500 text-sm",children:"%"})})]})]})}),Object(b.jsx)("div",{className:"col-span-2",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm",children:"Discount Amount"}),Object(b.jsx)(o.Input,{value:c(V),className:"mt-1",readOnly:!0})]})}),Object(b.jsx)("div",{className:"col-span-1",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm",children:"Tax %"}),Object(b.jsxs)("div",{className:"relative mt-1",children:[Object(b.jsx)(o.Input,{name:"taxRate",value:x.taxRate,onChange:U,className:"pl-3 pr-6 text-left text-sm w-20",type:"number",step:"0.01",min:"0",max:"99",maxLength:"2",style:{WebkitAppearance:"none",MozAppearance:"textfield"}}),Object(b.jsx)("div",{className:"absolute inset-y-0 right-0 pr-2 flex items-center pointer-events-none",children:Object(b.jsx)("span",{className:"text-gray-500 text-sm",children:"%"})})]})]})}),Object(b.jsx)("div",{className:"col-span-2",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm",children:"Tax Amount"}),Object(b.jsx)(o.Input,{value:c(D),className:"mt-1",readOnly:!0})]})}),Object(b.jsx)("div",{className:"col-span-3",children:Object(b.jsxs)(o.Label,{children:[Object(b.jsx)("span",{className:"text-sm font-semibold",children:"Total Amount"}),Object(b.jsx)(o.Input,{value:"".concat(t," ").concat(L.toFixed(2)),className:"mt-1 font-semibold",readOnly:!0})]})})]})}),Object(b.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[Object(b.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>{window.confirm("Are you sure you want to cancel? All changes will be lost.")&&e.push("/app/quotations")},disabled:f,children:"Cancel"}),Object(b.jsx)(o.Button,{type:"submit",style:{backgroundColor:"#AA1A21"},className:"text-white",disabled:f||0===_.length||0===k.length,children:f?"Updating...":"Update Quotation"})]})]})})]})}},51:function(e,t,c){"use strict";c(1);var a=c(3);t.a=function(e){let{children:t}=e;return Object(a.jsx)("h1",{className:"my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200",children:t})}},52:function(e,t,c){"use strict";c(1);var a=c(3);t.a=function(e){let{children:t}=e;return Object(a.jsx)("h2",{className:"mb-4 text-lg font-semibold text-gray-600 dark:text-gray-300",children:t})}},68:function(e,t,c){"use strict";c.d(t,"a",function(){return j});var a=c(1),s={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},n=a.createContext&&a.createContext(s),r=["attr","size","title"];function i(e,t){if(null==e)return{};var c,a,s=function(e,t){if(null==e)return{};var c={};for(var a in e)if(Object.prototype.hasOwnProperty.call(e,a)){if(t.indexOf(a)>=0)continue;c[a]=e[a]}return c}(e,t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);for(a=0;a<n.length;a++)c=n[a],t.indexOf(c)>=0||Object.prototype.propertyIsEnumerable.call(e,c)&&(s[c]=e[c])}return s}function l(){return l=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var c=arguments[t];for(var a in c)Object.prototype.hasOwnProperty.call(c,a)&&(e[a]=c[a])}return e},l.apply(this,arguments)}function o(e,t){var c=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),c.push.apply(c,a)}return c}function u(e){for(var t=1;t<arguments.length;t++){var c=null!=arguments[t]?arguments[t]:{};t%2?o(Object(c),!0).forEach(function(t){d(e,t,c[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(c)):o(Object(c)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(c,t))})}return e}function d(e,t,c){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var c=e[Symbol.toPrimitive];if(void 0!==c){var a=c.call(e,t||"default");if("object"!=typeof a)return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:c,enumerable:!0,configurable:!0,writable:!0}):e[t]=c,e}function b(e){return e&&e.map((e,t)=>a.createElement(e.tag,u({key:t},e.attr),b(e.child)))}function j(e){return t=>a.createElement(m,l({attr:u({},e.attr)},t),b(e.child))}function m(e){var t=t=>{var c,{attr:s,size:n,title:o}=e,d=i(e,r),b=n||t.size||"1em";return t.className&&(c=t.className),e.className&&(c=(c?c+" ":"")+e.className),a.createElement("svg",l({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},t.attr,s,d,{className:c,style:u(u({color:e.color||t.color},t.style),e.style),height:b,width:b,xmlns:"http://www.w3.org/2000/svg"}),o&&a.createElement("title",null,o),e.children)};return void 0!==n?a.createElement(n.Consumer,null,e=>t(e)):t(s)}}}]);
//# sourceMappingURL=14.22ee987d.chunk.js.map