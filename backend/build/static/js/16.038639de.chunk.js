(this["webpackJsonpquotation-maker"]=this["webpackJsonpquotation-maker"]||[]).push([[16],{216:function(e,t,c){"use strict";c.r(t);var a=c(5),n=c(1),i=c(4),s=c(13),l=c(51),r=c(52),o=c(24),d=c(25),u=c(3);t.default=function(){const e=Object(i.g)(),{currency:t,formatCurrency:c,getCurrencySymbol:j}=Object(d.b)(),{id:b}=Object(i.i)(),[m,p]=Object(n.useState)({client:"",title:"",description:"",discountType:"percentage",discountValue:0,taxRate:0,currency:""}),[x,O]=Object(n.useState)([{product:"",description:"",quantity:1,unitPrice:0,totalPrice:0}]),[h,y]=Object(n.useState)(!1),[g,v]=Object(n.useState)(!0),[f,N]=Object(n.useState)({}),[q,P]=Object(n.useState)(""),[_,C]=Object(n.useState)([]),[S,w]=Object(n.useState)([]),[F,T]=Object(n.useState)(0),[L,k]=Object(n.useState)(0),[I,A]=Object(n.useState)(0),[R,E]=Object(n.useState)(0);Object(n.useEffect)(()=>{b&&(async()=>{try{var e;v(!0),P("");const[t,c,a]=await Promise.all([Object(s.b)("/quotations/".concat(b)),Object(s.b)("/clients"),Object(s.b)("/products")]);if(!t.success)throw new Error("Quotation not found");const n=t.data.quotation;p({client:(null===(e=n.client)||void 0===e?void 0:e._id)||"",title:n.title||"",description:n.description||"",discountType:n.discountType||"percentage",discountValue:n.discountValue||0,taxRate:n.taxRate||0,currency:n.currency||""}),n.items&&n.items.length>0&&O(n.items.map(e=>{var t;return{product:(null===(t=e.product)||void 0===t?void 0:t._id)||e.product||"",description:e.description||"",quantity:e.quantity||1,unitPrice:e.unitPrice||0,totalPrice:e.totalPrice||0}})),c.success&&C(c.data.clients||[]),a.success&&w(a.data.products||[])}catch(t){console.error("Error loading quotation:",t),P(t.message||"Failed to load quotation")}finally{v(!1)}})()},[b]),Object(n.useEffect)(()=>{const e=x.reduce((e,t)=>e+(parseFloat(t.totalPrice)||0),0);T(e);const t=e*m.discountValue/100;k(t);const c=e-t,a=c*m.taxRate/100;A(a);E(c+a)},[x,m.discountType,m.discountValue,m.taxRate]);const V=e=>{const{name:t,value:c}=e.target;p(e=>Object(a.a)(Object(a.a)({},e),{},{[t]:"discountValue"===t||"taxRate"===t?parseFloat(c)||0:c})),f[t]&&N(e=>Object(a.a)(Object(a.a)({},e),{},{[t]:""})),q&&P("")},Q=(e,t,c)=>{const a=[...x];if(a[e][t]=c,"product"===t&&c){const t=S.find(e=>e._id===c);t&&(a[e].unitPrice=t.sellingPrice,a[e].description=t.description)}if("quantity"===t||"unitPrice"===t||"product"===t){const t=parseFloat(a[e].quantity)||0,c=parseFloat(a[e].unitPrice)||0;a[e].totalPrice=t*c}O(a)};return g?Object(u.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:Object(u.jsxs)("div",{className:"text-center",children:[Object(u.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-purple-600"}),Object(u.jsx)("p",{className:"mt-4 text-gray-600",children:"Loading quotation..."})]})}):Object(u.jsxs)(u.Fragment,{children:[Object(u.jsx)("div",{className:"flex justify-between items-center mb-6",children:Object(u.jsx)(l.a,{children:"Edit Quotation"})}),Object(u.jsx)("div",{className:"px-4 py-3 mb-8 bg-white rounded-lg shadow-md dark:bg-gray-800",children:Object(u.jsxs)("form",{onSubmit:async t=>{if(t.preventDefault(),(()=>{const e={};return m.client.trim()||(e.client="Client is required"),m.title.trim()||(e.title="Title is required"),x.forEach((t,c)=>{t.product||(e["item_".concat(c,"_product")]="Product is required"),(!t.quantity||parseFloat(t.quantity)<=0)&&(e["item_".concat(c,"_quantity")]="Quantity must be greater than 0"),(!t.unitPrice||parseFloat(t.unitPrice)<0)&&(e["item_".concat(c,"_unitPrice")]="Unit price cannot be negative")}),N(e),0===Object.keys(e).length})()){y(!0),P("");try{const t=Object(a.a)(Object(a.a)({},m),{},{items:x.map(e=>({product:e.product,description:e.description,quantity:parseFloat(e.quantity),unitPrice:parseFloat(e.unitPrice)}))}),c=await Object(s.d)("/quotations/".concat(b),t);c.success?(alert("Quotation updated successfully!"),e.push("/app/quotations")):P(c.message||"Failed to update quotation. Please try again.")}catch(i){var c,n;console.error("Error updating quotation:",i),null!==(c=i.response)&&void 0!==c&&null!==(n=c.data)&&void 0!==n&&n.message?P(i.response.data.message):i.message?P(i.message):P("Failed to update quotation. Please check your connection and try again.")}finally{y(!1)}}},children:[q&&Object(u.jsx)("div",{className:"mb-4 p-3 bg-red-100 border border-red-400 text-red-700 rounded",children:q}),Object(u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Client *"}),Object(u.jsxs)(o.Select,{className:"mt-1",name:"client",value:m.client,onChange:V,required:!0,valid:!f.client,children:[Object(u.jsx)("option",{value:"",children:"Select Client"}),_.map(e=>Object(u.jsxs)("option",{value:e._id,children:[e.name," - ",e.businessName]},e._id))]}),f.client&&Object(u.jsx)(o.HelperText,{valid:!1,children:f.client})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Currency"}),Object(u.jsx)(o.Input,{className:"mt-1",value:"".concat(t," - Will use default currency from configuration"),readOnly:!0,disabled:!0}),Object(u.jsx)(o.HelperText,{children:"Currency is set in Configuration settings"})]}),Object(u.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(u.jsx)("span",{children:"Title *"}),Object(u.jsx)(o.Input,{className:"mt-1",name:"title",value:m.title,onChange:V,placeholder:"Enter quotation title",required:!0,valid:!f.title}),f.title&&Object(u.jsx)(o.HelperText,{valid:!1,children:f.title})]}),Object(u.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(u.jsx)("span",{children:"Description"}),Object(u.jsx)(o.Textarea,{className:"mt-1",name:"description",value:m.description,onChange:V,rows:"3",placeholder:"Enter quotation description"})]})]}),Object(u.jsx)(r.a,{children:"Quotation Items"}),Object(u.jsxs)("div",{className:"mb-6",children:[x.map((e,t)=>Object(u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-6 gap-4 mb-4 p-4 border rounded-lg",children:[Object(u.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(u.jsx)("span",{children:"Product *"}),Object(u.jsxs)(o.Select,{className:"mt-1",value:e.product,onChange:e=>Q(t,"product",e.target.value),required:!0,valid:!f["item_".concat(t,"_product")],children:[Object(u.jsx)("option",{value:"",children:"Select Product"}),S.map(e=>Object(u.jsx)("option",{value:e._id,children:e.name},e._id))]}),f["item_".concat(t,"_product")]&&Object(u.jsx)(o.HelperText,{valid:!1,children:f["item_".concat(t,"_product")]})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Quantity *"}),Object(u.jsx)(o.Input,{className:"mt-1",type:"number",step:"0.01",min:"0",value:e.quantity,onChange:e=>Q(t,"quantity",e.target.value),placeholder:"1",required:!0,valid:!f["item_".concat(t,"_quantity")]}),f["item_".concat(t,"_quantity")]&&Object(u.jsx)(o.HelperText,{valid:!1,children:f["item_".concat(t,"_quantity")]})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Unit Price *"}),Object(u.jsx)(o.Input,{className:"mt-1",type:"number",step:"0.01",min:"0",value:e.unitPrice,onChange:e=>Q(t,"unitPrice",e.target.value),placeholder:"0.00",required:!0,valid:!f["item_".concat(t,"_unitPrice")]}),f["item_".concat(t,"_unitPrice")]&&Object(u.jsx)(o.HelperText,{valid:!1,children:f["item_".concat(t,"_unitPrice")]})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Total Price"}),Object(u.jsx)(o.Input,{className:"mt-1",type:"number",value:e.totalPrice.toFixed(2),readOnly:!0})]}),Object(u.jsx)("div",{className:"flex items-end",children:Object(u.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>(e=>{if(x.length>1){const t=x.filter((t,c)=>c!==e);O(t)}})(t),disabled:1===x.length,className:"w-full",children:"Remove"})})]},t)),Object(u.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>{O([...x,{product:"",description:"",quantity:1,unitPrice:0,totalPrice:0}])},className:"mt-2",children:"Add Item"})]}),Object(u.jsx)(r.a,{children:"Pricing Details"}),Object(u.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Subtotal"}),Object(u.jsx)(o.Input,{value:F.toFixed(2),className:"mt-1",type:"number",readOnly:!0})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Discount Value (%)"}),Object(u.jsxs)("div",{className:"relative mt-1",children:[Object(u.jsx)(o.Input,{name:"discountValue",value:m.discountValue,onChange:V,type:"number",step:"0.01",min:"0",max:"100",placeholder:"0",style:{WebkitAppearance:"none",MozAppearance:"textfield"},className:"pr-8"}),Object(u.jsx)("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center pointer-events-none",children:Object(u.jsx)("span",{className:"text-gray-500 sm:text-sm",children:"%"})})]})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Discount Amount"}),Object(u.jsx)(o.Input,{value:L.toFixed(2),className:"mt-1",type:"number",readOnly:!0})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Tax Rate (%)"}),Object(u.jsx)(o.Input,{name:"taxRate",value:m.taxRate,onChange:V,className:"mt-1",type:"number",step:"0.01",min:"0",max:"100"})]}),Object(u.jsxs)(o.Label,{children:[Object(u.jsx)("span",{children:"Tax Amount"}),Object(u.jsx)(o.Input,{value:I.toFixed(2),className:"mt-1",type:"number",readOnly:!0})]}),Object(u.jsxs)(o.Label,{className:"md:col-span-2",children:[Object(u.jsx)("span",{className:"text-lg font-semibold",children:"Total Amount"}),Object(u.jsx)(o.Input,{value:R.toFixed(2),className:"mt-1 text-lg font-semibold",type:"number",readOnly:!0})]})]}),Object(u.jsxs)("div",{className:"flex justify-end space-x-4 mt-6",children:[Object(u.jsx)(o.Button,{type:"button",layout:"outline",onClick:()=>{window.confirm("Are you sure you want to cancel? All changes will be lost.")&&e.push("/app/quotations")},disabled:h,children:"Cancel"}),Object(u.jsx)(o.Button,{type:"submit",style:{backgroundColor:"#AA1A21"},className:"text-white",disabled:h||0===_.length||0===S.length,children:h?"Updating...":"Update Quotation"})]})]})})]})}},51:function(e,t,c){"use strict";c(1);var a=c(3);t.a=function(e){let{children:t}=e;return Object(a.jsx)("h1",{className:"my-6 text-2xl font-semibold text-gray-700 dark:text-gray-200",children:t})}},52:function(e,t,c){"use strict";c(1);var a=c(3);t.a=function(e){let{children:t}=e;return Object(a.jsx)("h2",{className:"mb-4 text-lg font-semibold text-gray-600 dark:text-gray-300",children:t})}}}]);
//# sourceMappingURL=16.038639de.chunk.js.map